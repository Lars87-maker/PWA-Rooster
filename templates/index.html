<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF â†’ Agenda (ICS)</title>
  <link rel="manifest" href="/manifest.json"/>
  <meta name="theme-color" content="#4CAF50"/>
  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --primary:#4CAF50;
      --primary-600:#3e9e43;
      --ring:#a7f3d0;
      --border:#e2e8f0;
      --shadow:0 10px 30px rgba(2,6,23,.08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font:16px/1.5 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:var(--bg);
      display:grid;
      place-items:center;
      padding:24px;
    }
    .card{
      width:min(680px, 100%);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:28px 28px 22px;
    }
    h1{
      margin:0 0 6px;
      font-size:clamp(20px, 2.2vw, 28px);
      letter-spacing:.2px;
    }
    p.lead{
      margin:0 0 18px;
      color:var(--muted);
    }

    /* Upload-tegel */
    .upload{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      width:100%;
      min-height:84px;
      padding:16px;
      border:2px dashed #9ad6a0;
      border-radius:12px;
      background:#f7fff8;
      color:#0b3d18;
      cursor:pointer;
      transition:box-shadow .2s, transform .04s;
      outline:none;
    }
    .upload:hover{ box-shadow:0 0 0 4px var(--ring); }
    .upload:focus-within{ box-shadow:0 0 0 4px var(--ring); }
    .upload:active{ transform:translateY(1px); }
    .upload input{ display:none; }
    .upload .label{
      font-weight:600;
    }
    .subtle{
      font-size:.9rem;
      color:#246b35;
    }

    /* Actie-balk */
    .row{ display:flex; gap:12px; align-items:center; margin-top:14px; }
    .btn{
      appearance:none; border:0; cursor:pointer;
      padding:12px 16px; border-radius:10px;
      background:var(--primary); color:#fff; font-weight:700;
      transition:background .15s, transform .04s, box-shadow .2s;
      box-shadow:0 6px 18px rgba(76,175,80,.22);
    }
    .btn:hover{ background:var(--primary-600); }
    .btn:active{ transform:translateY(1px); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; box-shadow:none; }

    /* Meldingen */
    .msg{ margin-top:10px; padding:10px 12px; border-radius:10px; display:none; }
    .msg.error{ background:#fff1f2; color:#b91c1c; border:1px solid #fecaca; }
    .msg.ok{ background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; }

    /* Verberg eventuele â€˜verdwaaldeâ€™ bullets/punten in de layout */
    ul,ol{ list-style:none; padding-left:0; }
  </style>
</head>
<body>
  <main class="card">
    <h1>PDF â†’ Agenda (ICS)</h1>
    <p class="lead">Upload je PDF-rooster. Je krijgt een <code>.ics</code>-bestand terug.</p>

    <form id="form" method="POST" action="/upload" enctype="multipart/form-data" novalidate>
      <label class="upload" id="drop">
        <input id="file" name="file" type="file" accept="application/pdf" />
        <div>
          <div class="label" id="filename">Klik om PDF te kiezen</div>
          <div class="subtle">of sleep je bestand hierheen</div>
        </div>
      </label>

      <div class="row">
        <button class="btn" id="submit" type="submit" disabled>Maak ICS</button>
      </div>

      <div class="msg error" id="error"></div>
      <div class="msg ok" id="ok"></div>
    </form>
  </main>

  <script>
    // Service worker blijft zoals je had:
    if ("serviceWorker" in navigator) { navigator.serviceWorker.register("/service-worker.js"); }

    const file     = document.getElementById("file");
    const drop     = document.getElementById("drop");
    const submit   = document.getElementById("submit");
    const filename = document.getElementById("filename");
    const errorBox = document.getElementById("error");
    const okBox    = document.getElementById("ok");
    const form     = document.getElementById("form");

    const setFileName = () => {
      if (file.files.length) {
        filename.textContent = "ðŸ“„ " + file.files[0].name;
        submit.disabled = false;
      } else {
        filename.textContent = "Klik om PDF te kiezen";
        submit.disabled = true;
      }
    };
    file.addEventListener("change", setFileName);

    // Drag & drop polish
    ["dragenter","dragover"].forEach(ev =>
      drop.addEventListener(ev, e => { e.preventDefault(); drop.classList.add("hover"); })
    );
    ["dragleave","drop"].forEach(ev =>
      drop.addEventListener(ev, e => { e.preventDefault(); drop.classList.remove("hover"); })
    );
    drop.addEventListener("drop", e => {
      const dt = e.dataTransfer;
      if (dt && dt.files && dt.files[0]) {
        file.files = dt.files;
        setFileName();
      }
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorBox.style.display = "none";
      okBox.style.display = "none";

      const fd = new FormData(form);
      try {
        const res = await fetch("/upload", { method: "POST", body: fd });
        if (!res.ok) {
          const data = await res.json().catch(() => ({}));
          errorBox.textContent = data.error || `Fout (${res.status})`;
          errorBox.style.display = "block";
          return;
        }
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = "rooster.ics";
        document.body.appendChild(a); a.click(); a.remove();
        URL.revokeObjectURL(url);
        okBox.textContent = "ICS succesvol gegenereerd ðŸŽ‰";
        okBox.style.display = "block";
      } catch (err) {
        errorBox.textContent = "Netwerkfout. Probeer opnieuw.";
        errorBox.style.display = "block";
      }
    });
  </script>
</body>
</html>
