<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rooster Webtool</title>
  <link rel="manifest" href="/manifest.json"/>
  <meta name="theme-color" content="#4CAF50"/>
  <style>
    body { font-family: system-ui, Arial, sans-serif; background:#f4f7f9; margin:0; min-height:100vh; display:grid; place-items:center; }
    .card { background:#fff; padding:24px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,.06); max-width:560px; width:92%; }
    h1 { margin:0 0 8px; font-size:1.4rem; }
    p { margin:0 0 16px; color:#555; }
    .upload { border:2px dashed #4CAF50; border-radius:10px; padding:14px; background:#f9fff9; cursor:pointer; text-align:center; }
    .row { display:flex; gap:12px; align-items:center; margin-top:12px; }
    button { background:#4CAF50; color:#fff; border:none; padding:12px 16px; border-radius:8px; cursor:pointer; font-weight:600; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    #error { color:#b00020; margin-top:10px; display:none; }
    #ok { color:#0a7a3b; margin-top:10px; display:none; }
  </style>
</head>
<body>
  <div class="card">
    <h1>PDF â†’ Agenda (ICS)</h1>
    <p>Upload je PDF-rooster. Je krijgt een <code>.ics</code>-bestand terug.</p>

    <form id="form" method="POST" action="/upload" enctype="multipart/form-data">
      <label class="upload">
        <input id="file" name="file" type="file" accept="application/pdf" hidden />
        <span id="filename">Klik om PDF te kiezenâ€¦</span>
      </label>
      <div class="row">
        <button id="submit" type="submit" disabled>Maak ICS</button>
      </div>
      <div id="error"></div>
      <div id="ok"></div>
    </form>
  </div>

  <script>
    // Registreer SW
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js");
    }

    const file = document.getElementById("file");
    const submit = document.getElementById("submit");
    const filename = document.getElementById("filename");
    const errorBox = document.getElementById("error");
    const okBox = document.getElementById("ok");
    const form = document.getElementById("form");

    file.addEventListener("change", () => {
      if (file.files.length) {
        filename.textContent = "ðŸ“„ " + file.files[0].name;
        submit.disabled = false;
      } else {
        filename.textContent = "Klik om PDF te kiezenâ€¦";
        submit.disabled = true;
      }
    });

    // Vang het submitten af zodat we nette fouten kunnen tonen
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorBox.style.display = "none";
      okBox.style.display = "none";

      const fd = new FormData(form);
      try {
        const res = await fetch("/upload", { method: "POST", body: fd });
        if (!res.ok) {
          const data = await res.json().catch(() => ({}));
          const msg = data.error || `Fout (${res.status})`;
          errorBox.textContent = msg;
          errorBox.style.display = "block";
          return;
        }
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "rooster.ics";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        okBox.textContent = "ICS succesvol gegenereerd ðŸŽ‰";
        okBox.style.display = "block";
      } catch (err) {
        errorBox.textContent = "Netwerkfout. Probeer opnieuw.";
        errorBox.style.display = "block";
      }
    });
  </script>
</body>
</html>
